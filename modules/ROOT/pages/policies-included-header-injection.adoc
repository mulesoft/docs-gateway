= Header Injection Policy
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../assets/images
:keywords: header injection, api gateway, flex gateway, gateway, policy
:page-aliases: api-manager::header-injection-policy.adoc, general:header-inject-remove-task.adoc

[width="100%", cols="5,15"]
|===
>s|Policy name | Header Injection
>s|Summary      | Adds headers to a request or a response
>s|Category | Transformation
>s|First Mule version available | v4.1.0
.3+>.^s| Returned Status Codes |

| 500 - The configuration includes an expression that was not evaluated.  
|===

== Summary

The Header Injection policy adds HTTP headers to the request or response of a message. When you configure this policy for your API, you must specify an inbound and outbound map of the headers that you want to add in the message processing in the form of a key-value pair.

image::header-inject-remove-diagram.png[]

You can optionally include DataWeave expressions in the value of the header. For example, all headers matching the following configured expression are injected to the message:

`“#[attributes.requestPath]”`

If the injected header already exists in the message attributes, the policy creates a new header without overriding the value of the existing one. 

[NOTE]
====
To overwrite an existing message header, remove the existing header before you add your header. See the Header Removal policy.
====

== Configuring Policy Parameters

=== Local Mode for Flex

In Local Mode, you apply the Header Injection policy to your API via declarative configuration files. Refer to the following policy definition and table of parameters:

----
- policyRef:
    name: header-injection-flex
  config:
    inboundHeaders: // OPTIONAL, default: []
      - name: <string> // REQUIRED
        value: <string> // REQUIRED
    outboundHeaders: // OPTIONAL, default: []
      - name: <string> // REQUIRED
        value: <string> // REQUIRED
----

[%header%autowidth.spread,cols="a,a,a,a"]
|===

|Parameter | Required or Optional | Default Value | Description

| `inboundHeaders` 
| Optional
| empty array
| Map of header names or regular expressions to be injected at the beginning of the message processing, for example, `host, content.*` 

| `inboundHeaders.name` 
| Required
| N/A
| A string 

| `inboundHeaders.value` 
| Required
| N/A
| A string 

| `outboundHeaders` 
| Optional
| empty array
| List of header names or regular expressions to be injected at the end of the message processing, for example, `content-type` 

| `outboundHeaders.name` 
| Required
| N/A
| A string 

| `outboundHeaders.value` 
| Required
| N/A
| A string 

|===

*Both `inboundHeaders` and `outboundHeaders` may not be empty at the same time.

==== Resource Configuration Example

In the following example, all the headers matching the configured `#[attributes.requestPath]` expression are injected into the message.

----
- policyRef:
    name: header-injection-flex
    config:
      inboundHeaders:
        - name: "new inbound header"
          value: "#[attributes.requestPath]"
      outboundHeaders:
        - name: "new outbound header"
          value: "#[attributes.requestPath]"
----

=== Connected Mode

When you apply the policy to your API from the UI, the following parameters are displayed:

[%header%autowidth.spread,cols="a,a"]
|===
| *Parameter* | *Description* 
|Inbound Header Map  | List of header names or regular expressions (comma-separated) to be injected at the beginning of the message processing, for example, `host, content.*`
|Outbound Header Map | List of header names or regular expressions (comma-separated) to be injected at the end of the message processing, for example, `content-type`
|Method & Resource conditions |The option to add configurations to only a select few or all methods and resources of the API
|===

[NOTE]
====
Comma-separated values are not considered multiple values by the Mule HTTP Connector.
====










