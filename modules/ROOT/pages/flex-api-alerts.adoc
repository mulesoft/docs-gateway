= Flex Gateway API Alerts

With API alerts for Flex Gateway, you can add and configure email notifications that flag unusual API behavior, such as:

* An API response time over 60 seconds
* More than 1000 API requests in 30 seconds

See <<Adding API Alerts>>.

[[types]]
You can add the following API alerts to an API instance:

* *Policy Violation*
+
An infraction of one or more policies governing the API occurs.

* *Request Count*
+
Users request access to the API more times than allowed in a specified interval of time.
+
Specify time interval values from 1 through 999999999. To prevent data bursts, intervals are implemented as sliding windows instead of as absolute minute boundaries. See https://www.techopedia.com/definition/869/sliding-window[Sliding Windows].

* *Response Code*
+
The API returns one of these HTTP codes upon receiving a request: 400, 401, 403, 404, 408, 500, 502, or 503.

* *Response Time*
+
The response time of the API exceeds a specified timeout period.

API alerts are triggered only when states change, although the first occurrence of a state change might be undetected due to newly created alerts not having defined states.

When configuring an API alert, you select Business Group users to receive email notifications about the alert. Notifications include information about events that trigger alerts as specified by severity level. Users receive the following:

* One email describes the alert:
+
`Your API, CesarDemoAPI - Basic:151 (Environment: "NewOne"), has received greater than 2 requests within 1 consecutive periods of 1 minutes.`
+
* Another email notifies you when the alert is resolved.
+
`Your API Version, jsonplaceholderapi - 1.0.development, is no longer in an alert state. The number of policy violations was not greater than 1 in the last 1 consecutive periods of 1 minutes.`

After an alert is triggered, the first set of two notification emails is sent and API Manager stops listening for alerts until the next alert period begins. This technique prevents repeated notification emails.

[NOTE]
API Alerts are sent from `no-reply@mulesoft.com`. This cannot be customized.

== Adding API Alerts
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

To track and manage APIs, you can add one or more API alerts to your API instances. Add different <<types, types of alerts>> based on your requirements.

The maximum number of alerts you can create per API instance depends on your plan. Deleting alerts allows you to create new ones.

[NOTE]
Alerts cannot be added to API instances protected by xref:https://docs.mulesoft.com/api-manager/2.x/automated-policies-landing-page[automated policies].

To add an API alert:

. Navigate to *API Manager* > *API Administration* and click the API instance for which you want to add an alert.
. From the left navigation pane, select *Alerts* > *New alert*.
. Specify the alert options:
* *Name*:
+
Type an alert name, for example `trial-alert`.
+
You can delete an alert anytime if not required.
* *Severity*:
+
Select a severity for the alert:

** *Info*
+
May be assigned to alerts that do not require immediate attention when triggered. This severity indicates the metric should be passively monitored.
** *Warning*
+
May be assigned to alerts that require prompt attention when triggered. This severity indicates an alert should be closely monitored.
** *Critical*
+
May be assigned to alerts that require immediate attention when triggered. This severity indicates an alert should receive an immediate response.
. Specify the alert conditions:
* *Metric*
+
Condition that triggers the alert.
//should any information be added from Sara's "Alert Conditions" section for basic alerts, which lists metrics?

* *Logic*
+
Indicate when the alert will be triggered based on the occurrence rate defined in the *When number of occurrences are* and *For at least [number of] minutes* fields.

. Configure the email notification:

* *Subject*
+
Subject of the alert email to send when the alert is triggered
+
The subject can include variables.
See <<alert-variables>>.

* *Message*
+
Body text for the email to send when the alert is triggered
+
The message body can include variables.
See <<alert-variables>>.

* *Recipients*
+
Recipients of the alert email
+
You can select up to 20 platform user IDs and enter up to 20 email addresses.

. Click *Create*.

[NOTE]
You can enable and disable alerts on the Alerts page. See <<enabling-alerts>>.

//content pulled from basic alert email template - much of this information is not needed
=== Alert Email Template

You can use the following variables in the *Subject* and *Message* fields for basic email alerts.

For the description of each variable, see <<alert-variables>>.

[%header,cols="25a,50a,20a"]
.Variables for Alerts
|===
| Alert Type | Alert | Applicable Variables
.6+| CloudHub App Alerts
|*CPU Utilization* .6+|* `${severity}`
* `${operator}`
* `${threshold}`
* `${period}`
* `${value}`
* `${condition}`
* `${organization}`
* `${environment}`
* `${alertLink}`
* `${dashboardLink}`
* `${resource}`
| *Memory Utilization*
| *Thread Count*
| *Message Count*
| *Message Error Count*
| *Message Response Time*

.6+| Anypoint Runtime Fabric App Alerts
|*CPU Utilization* .6+|* `${severity}`
* `${operator}`
* `${threshold}`
* `${period}`
* `${value}`
* `${condition}`
* `${organization}`
* `${environment}`
* `${alertLink}`
* `${dashboardLink}`
* `${resource}`
| *Memory Utilization*
| *Thread Count*
| *Message Count*
| *Message Error Count*
| *Message Response Time*

.3+|Hybrid App Alerts
| *Message Count* .3+| * `${severity}`
* `${operator}`
* `${threshold}`
* `${period}`
* `${value}`
* `${condition}`
* `${organization}`
* `${environment}`
* `${alertLink}`
* `${dashboardLink}`
* `${targetName}`
* `${resource}`
| *Message Error Count*
| *Message Response Time*

.3+|On-premises Server Alerts
| *CPU Utilization* .3+| * `${severity}`
* `${operator}`
* `${threshold}`
* `${period}`
* `${value}`
* `${condition}`
* `${organization}`
* `${environment}`
* `${alertLink}`
* `${dashboardLink}`
* `${targetName}`
| *Memory Utilization*
| *Thread Count*

.3+|Server Group Alerts
| *CPU Utilization* .3+| * `${severity}`
* `${operator}`
* `${threshold}`
* `${period}`
* `${value}`
* `${condition}`
* `${organization}`
* `${environment}`
* `${alertLink}`
* `${dashboardLink}`
* `${memberName}`
* `${targetName}`
| *Memory Utilization*
| *Thread Count*

.3+|Server Cluster Alerts
| *CPU Utilization* .3+| * `${severity}`
* `${operator}`
* `${threshold}`
* `${period}`
* `${value}`
* `${condition}`
* `${organization}`
* `${environment}`
* `${alertLink}`
* `${dashboardLink}`
* `${memberName}`
* `${targetName}`
| *Memory Utilization*
| *Thread Count*

|===

[[alert-variables]]

[%header%autowidth.spread]
[[alert-variables]]
.Variable Definitions
|===
|Variable |Definition
|`${alertLink}`|URL of the triggered alert
|`${alertState}`|State of the alert when it was triggered.

Available values are `OK` or `Alerting`.
|`${comparison}`|* Above, above or equal, equal, below or equal, below
|`${condition}`|Metric for which the alert is triggered
|`${environment}`|Name of the environment in which the resource is deployed
|`${memberName}`|Name of the server within the server group or cluster
|`${operator}` |An operator, such as `< > =`
|`${organization}` |Name of the organization that owns the alert
|`${period}` |Period of time over which to measure
|`${resource}` a| Name of the item that triggers the alert:

* CloudHub Apps: Name of the app that triggers the alert
* Hybrid Apps: Name of the resource in the app that triggers the alert
|`${severity}` | Severity of the alert
|`${targetName}`|Name of the server, server group, or cluster
|`${targetState}` |Server state when the alert was triggered
|`${threshold}` |Count over the period of time that triggers the alert
|`${value}` | Value of the metric that triggers the alert
|===



//subject/message/recipient from Set Up Basic Alerts for Servers and Mule Apps - add this to the appropriate place in the add alert steps above


[[enabling-alerts]]

== Editing, Enabling, or Disabling API Alerts
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

When creating an alert, you can enable or disable an alert by toggling the switch on the right:

* Enabling a disabled alert causes the alert to transition to *Pending* until it is time for evaluation.
+
Depending on the value, the alert transitions to *OK* or *Alerting*.

* Disabling an alert causes the alert to transition to *Disabled*.

You can also edit an existing alert.

. In API Manager click *API Administration* on the left navigation bar.
. Click the API instance, and version that you want to edit and click *Alerts*.
. Click *Edit* from the kebab menu on the alert you want to edit.
+
//image::edit-enable-disable-alerts-task-7e2ac.png[]
//should the image above be replaced with one for flex gateway alerts?


== Testing API Alerts
//is the following enough for testing alerts? also, all links go to beta documentation, so wondering if they will work
The process for testing API alerts begins with creating a Flex Gateway. Follow these steps to get started with Flex Gateway and test alerts:

. xref:https://beta.docs.stgx.mulesoft.com/beta-flex-gateway-ga/gateway/flex-install[Install Flex Gateway]
. Register and Run Flex Gateway
+
* xref:https://beta.docs.stgx.mulesoft.com/beta-flex-gateway-ga/gateway/flex-conn-reg-run[Register and Run in Connected Mode]
* xref:https://beta.docs.stgx.mulesoft.com/beta-flex-gateway-ga/gateway/flex-local-reg-run[Register and Run in Local Mode]
. Manage an API with Flex Gateway
+
* xref:https://beta.docs.stgx.mulesoft.com/beta-flex-gateway-ga/gateway/flex-conn-manage[Manage an API in Connected Mode]
* xref:https://beta.docs.stgx.mulesoft.com/beta-flex-gateway-ga/gateway/flex-local-manage[Manage an API in Local Mode]

== Viewing and Deleting API Alerts
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

If you have been granted the *Organization Administrators* role for the master organization, you can view a list of alerts that are generated for APIs in API Manager.

Before you can view and delete alerts, ensure that you have:

* *Manage Alerts* permission to view and delete API alerts.
* *View Alerts* permission for view-only access to alerts.

For more information about how to set these permissions, see xref:https://docs.mulesoft.com/api-manager/2.x/environment-permission-task[To Set Permissions].

To view and delete alerts:

. From API Manager, click *API Administration > API instance*, and select Alerts.
+
//image::new-alerts.png[width=687,height=235]
//should this image be replaced?
+
. Expand an alert in the list.
+
Details about the alert options appear.
+
. Click *Delete*.
